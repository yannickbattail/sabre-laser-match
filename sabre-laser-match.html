<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>Sabre laser - match</title>
    <style>
      #score0, #score1 {
        width: 40px;
      }
    </style>
  </head>
  <body>
  Temps restant:<span id="restant">00:00</span>
  <table border="2">
    <thead>
      <tr>
        <th>Combattant vert</th>
        <th>Combattant rouge</th>
      </tr>
    </thead>
    <tbody>
    <tr>
      <td>
        <input type="number" id="score0" value="0" readonly="readonly" autocomplete='off' />
      </td>
      <td>
        <input type="number" id="score1" value="0" readonly="readonly" autocomplete='off' />
      </td>
    </tr>
    <tr>
      <td>
        <button onclick="touche(1, 0)">+1</button>
        <button onclick="touche(3, 0)">+3</button>
        <button onclick="touche(5, 0)">+5</button>
      </td>
      <td>
        <button onclick="touche(1, 1)">+1</button>
        <button onclick="touche(3, 1)">+3</button>
        <button onclick="touche(5, 1)">+5</button>
      </td>
    </tr>
    <tr>
      <td>
        <button onclick="carton(0, 0)">blanc</button>
        <button onclick="carton(1, 0)">jaune</button>
        <button onclick="carton(2, 0)">rouge</button>
        <button onclick="carton(3, 0)">noir</button>
      </td>
      <td>
        <button onclick="carton(0, 1)">blanc</button>
        <button onclick="carton(1, 1)">jaune</button>
        <button onclick="carton(2, 1)">rouge</button>
        <button onclick="carton(3, 1)">noir</button>
      </td>
    </tr>
    </tbody>
  </table>
  <div>
    <select id="historique" multiple="multiple"></select>
  </div>
  <button onclick="annuler()">Annuler la derni√®re action</button>
  <script>
    const CARTONS = [
      {
        couleur: 'blanc',
        points: 0
      },
      {
        couleur: 'jaune',
        points: -2
      },
      {
        couleur: 'rouge',
        points: -5
      },
      {
        couleur: 'noir',
        points: -15
      }
    ];
    const COMBATTANTS = ['vert', 'rouge'];
    function carton(cartonNum, combatant) {
      ajoutHistorique(COMBATTANTS[combatant]+ ": carton " + CARTONS[cartonNum].couleur + " " + CARTONS[cartonNum].points, CARTONS[cartonNum].points);
      changeScore(CARTONS[cartonNum].points, combatant);
    }
    function touche(points, combatant) {
      ajoutHistorique(COMBATTANTS[combatant]+ ": touche +"+ points, points);
      changeScore(points, combatant);
    }
    function annuler() {
      const historique = document.getElementById("historique");
      if (historique.options.length === 0) return ;
      const lastIndex = historique.options.length - 1;
      const combatant = historique.options[lastIndex].text.startsWith("vert")?0:1;
      const points = Number(historique.options[lastIndex].value);
      changeScore(points * -1, combatant);
      historique.remove(lastIndex);
    }
    function ajoutHistorique(texte, points) {
      const historique = document.getElementById("historique");
      const option = document.createElement("option");
      option.text = texte;
      option.value = points;
      historique.add(option);
      historique.scrollTop = historique.scrollHeight;
    }
    function changeScore(points, combatant) {
      const scoreInput = document.getElementById('score'+combatant);
      console.log(scoreInput.value, points, combatant);
      scoreInput.value = Number(scoreInput.value) + points;
    }
  </script>
  </body>
</html>
