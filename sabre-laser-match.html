<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>Sabre laser - match</title>
    <style>
      #score0, #score1 {
        width: 40px;
      }
    </style>
  </head>
  <body>
  Temps restant:<span id="restant">00:00</span>
  <table border="2">
    <thead>
      <tr>
        <th>Combattant vert</th>
        <th>Combattant rouge</th>
      </tr>
    </thead>
    <tbody>
    <tr>
      <td>
        <input type="number" id="scoreVert" value="0" readonly="readonly" autocomplete='off' />
      </td>
      <td>
        <input type="number" id="scoreRouge" value="0" readonly="readonly" autocomplete='off' />
      </td>
    </tr>
    <tr>
      <td>
        <button onclick="touche('main', 'vert')">+1</button>
        <button onclick="touche('membre', 'vert')">+3</button>
        <button onclick="touche('tronc', 'vert')">+5</button>
      </td>
      <td>
        <button onclick="touche('main', 'rouge')">+1</button>
        <button onclick="touche('membre', 'rouge')">+3</button>
        <button onclick="touche('tronc', 'rouge')">+5</button>
      </td>
    </tr>
    <tr>
      <td>
        <button onclick="carton('blanc', 'vert')">blanc</button>
        <button onclick="carton('jaune', 'vert')">jaune</button>
        <button onclick="carton('rouge', 'vert')">rouge</button>
        <button onclick="carton('noir', 'vert')">noir</button>
      </td>
      <td>
        <button onclick="carton('blanc', 'rouge')">blanc</button>
        <button onclick="carton('jaune', 'rouge')">jaune</button>
        <button onclick="carton('rouge', 'rouge')">rouge</button>
        <button onclick="carton('noir', 'rouge')">noir</button>
      </td>
    </tr>
    </tbody>
  </table>
  <div>
    <select id="historique" multiple="multiple"></select>
  </div>
  <button onclick="annuler()">Annuler la derni√®re action</button>
  <script>
    class Event {
      temps;
      combattant;
      type;
      nom;
      constructor(temps, combattant, type, nom) {
        this.temps = temps;
        this.combattant = combattant;
        this.type = type;
        this.nom = nom;
      }
    }
    const CARTONS = {
      blanc: {
        couleur: 'blanc',
        points: 0
      },
      jaune:{
        couleur: 'jaune',
        points: -2
      },
      rouge:{
        couleur: 'rouge',
        points: -5
      },
      noir:{
        couleur: 'noir',
        points: -15
      }
    };
    const TOUCHES = {
      main: {
        points: 1
      },
      membre:{
        points: 2
      },
      tronc:{
        points: 5
      },
    };
    const COMBATTANTS = {
      vert: {
        couleur: 'vert',
        nom: "combattant vert",
      },
      rouge: {
        couleur: 'rouge',
        nom: "combattant rouge",
      }
    };
    const historique = [];
    function carton(carton, combatant) {
      historique.push(new Event(getTime(), combatant, 'carton', carton));
      refresh();
    }
    function touche(type, combatant) {
      historique.push(new Event(getTime(), combatant, 'touche', type));
      refresh();
    }
    function annuler() {
      historique.pop();
      refresh();
    }
    function ajoutHistorique(event) {
      const historiqueSelect = document.getElementById("historique");
      const option = document.createElement("option");
      if (event.type === 'carton') option.text = `[${event.temps}] ${event.combattant}: ${event.type} ${event.nom} (${CARTONS[event.nom].points})`;
      else if (event.type === 'touche') option.text = `[${event.temps}] ${event.combattant}: ${event.type} ${event.nom} (${TOUCHES[event.nom].points})`;
      else if (event.type === 'debut') option.text = `[${event.temps}] Combattez!`;
      historiqueSelect.add(option);
      historiqueSelect.scrollTop = historiqueSelect.scrollHeight;
    }
    function updateScore() {
      document.getElementById('scoreVert').value = historique.filter(e => e.combattant === 'vert').map(e => {
        if (e.type === 'carton') return CARTONS[e.nom].points;
        else if (e.type === 'touche') return TOUCHES[e.nom].points;
        else return 0;
      }).reduce((a, b) => a + b, 0)
      document.getElementById('scoreRouge').value = historique.filter(e => e.combattant === 'rouge').map(e => {
        if (e.type === 'carton') return CARTONS[e.nom].points;
        else if (e.type === 'touche') return TOUCHES[e.nom].points;
        else return 0;
      }).reduce((a, b) => a + b, 0)
    }
    function refresh() {
      const historiqueSelect = document.getElementById("historique");
      historiqueSelect.innerHTML = "";
      historique.map(e => ajoutHistorique(e));
      historiqueSelect.scrollTop = historiqueSelect.scrollHeight;
      updateScore();
    }
    function getTime() {
      return 0;
    }
  </script>
  </body>
</html>
